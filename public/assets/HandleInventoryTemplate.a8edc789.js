import{y as qe,a5 as Ee,a6 as ze,r as f,c as M,w as me,h as W,z as ce,av as Ue,I as je,g as ye,P as Pe,bm as Ne,H as Me,o as _e,bn as fe,k as x,l as U,m as c,d as l,x as Z,s as ne,Q as ee,bo as ie,q as L,bi as Y,n as J,F as se,a1 as pe,ak as ve,ar as Ze,am as j,a2 as $,a3 as re,p as be,ai as Ve,bp as We,bq as $e,a8 as He,ac as Ke,ah as Ye,ao as Je,S as ge,aU as Ge,u as Xe,aq as ke}from"./index.12e37f59.js";import{Q as et}from"./QToolbar.0e3e71d4.js";import{Q as tt,a as Se,b as at}from"./QBreadcrumbs.47eb01c7.js";import{T as lt,Q as Ce,C as ot}from"./ClosePopup.37ad25ce.js";import{b as nt,Q as De,I as he,a as it,h as rt}from"./verify.03586b2d.js";import{u as Fe,Q as st}from"./use-quasar.e2f4d4dd.js";import{g as we,f as Ie,Q as X}from"./QMenu.de27ec6d.js";import{_ as de}from"./plugin-vue_export-helper.21dcd24c.js";import dt from"./supabase.cc68771d.js";import"./QResizeObserver.f2766778.js";import"./index.2cf0d985.js";import"./index.dedf2e02.js";var ut=qe({name:"QSplitter",props:{...Ee,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(e,{slots:a,emit:y}){const{proxy:{$q:t}}=ye(),s=ze(e,t),p=f(null),n={before:f(null),after:f(null)},d=M(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(s.value===!0?" q-splitter--dark":"")),v=M(()=>e.horizontal===!0?"height":"width"),k=M(()=>e.reverse!==!0?"before":"after"),C=M(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function B(b){return(e.unit==="%"?b:Math.round(b))+e.unit}const P=M(()=>({[k.value]:{[v.value]:B(e.modelValue)}}));let Q,F,A,I,T;function H(b){if(b.isFirst===!0){const D=p.value.getBoundingClientRect()[v.value];Q=e.horizontal===!0?"up":"left",F=e.unit==="%"?100:D,A=Math.min(F,C.value[1],Math.max(C.value[0],e.modelValue)),I=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:t.lang.rtl===!0?-1:1)*(e.unit==="%"?D===0?0:100/D:1),p.value.classList.add("q-splitter--active");return}if(b.isFinal===!0){T!==e.modelValue&&y("update:modelValue",T),p.value.classList.remove("q-splitter--active");return}const h=A+I*(b.direction===Q?-1:1)*b.distance[e.horizontal===!0?"y":"x"];T=Math.min(F,C.value[1],Math.max(C.value[0],h)),n[k.value].value.style[v.value]=B(T),e.emitImmediately===!0&&e.modelValue!==T&&y("update:modelValue",T)}const K=M(()=>[[lt,H,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function S(b,h){b<h[0]?y("update:modelValue",h[0]):b>h[1]&&y("update:modelValue",h[1])}return me(()=>e.modelValue,b=>{S(b,C.value)}),me(()=>e.limits,()=>{Pe(()=>{S(e.modelValue,C.value)})}),()=>{const b=[W("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:P.value.before},ce(a.before)),W("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[Ue("div",{class:"q-splitter__separator-area absolute-full"},ce(a.separator),"sep",e.disable!==!0,()=>K.value)]),W("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:P.value.after},ce(a.after))];return W("div",{class:d.value,ref:p},je(a.default,b))}}});function le(){const{emit:e,proxy:a}=ye(),y=f(null);function t(){y.value.show()}function s(){y.value.hide()}function p(d){e("ok",d),s()}function n(){e("hide")}return Object.assign(a,{show:t,hide:s}),{dialogRef:y,onDialogHide:n,onDialogOK:p,onDialogCancel:s}}const Ae=["ok","hide"];le.emits=Ae;le.emitsObject=Ne(Ae);const ct={props:{simple:{type:Object,required:!1}},emits:[...le.emits],setup(e,{emit:a}){const y=Fe(),t=f(0),s=f([]),p=f(""),n=f(0),d=f([]),v=f(""),k=f(!0),C=f([]),B=f([]);Me({noti:()=>{}});const{dialogRef:P,onDialogHide:Q,onDialogOK:F,onDialogCancel:A}=le(),I=r=>{try{return r.replace(/^./,r[0].toUpperCase())}catch(u){console.log("mark : FW-FA5675C5CBD0",u)}},T=()=>{try{y.dialog({title:"A\xF1adir Zonas",message:"A\xF1ade el nombre de la zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{b(I(r.toLowerCase()))})}catch(r){console.log("mark : FW-8DD303A05CDF",r)}},H=()=>{try{y.dialog({title:"A\xF1adir Sub-Zonas",message:"A\xF1ade el nombre de la sub-zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{h(I(r.toLowerCase()))})}catch(r){console.log("mark : FW-55E3164DC593",r)}},K=r=>{try{k.value=!1,t.value=r.idZone,p.value=r.name;let u=s.value.findIndex(_=>_.idZone===r.idZone);d.value=s.value[u].subZone}catch(u){console.log("mark : FW-DF749FC08A5A",u)}},S=r=>{try{n.value=r.idSubZone,v.value=r.nameSubZone}catch(u){console.log("mark : FW-2C36D976C391",u)}},b=r=>{try{s.value.push({idZone:fe(),name:r,subZone:[]}),s.value.sort(function(u,_){return u.name>_.name?1:u.name<_.name?-1:0})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},h=r=>{try{d.value=[],s.value.forEach((u,_)=>{u.idZone===t.value&&(s.value[_].subZone.push({idZone:u.idZone,idSubZone:fe(),nameSubZone:r}),s.value[_].subZone.sort(function(z,V){return z.nameSubZone>V.nameSubZone?1:z.nameSubZone<V.nameSubZone?-1:0}),d.value=s.value[_].subZone)})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},D=r=>{try{y.dialog({title:`Editar Zona ${r.name}`,message:"Cambia nombre de la zona",prompt:{model:r.name,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(z=>z.idZone===t.value);s.value[_].name=I(u.toLowerCase()),s.value.sort(function(z,V){return z.name>V.name?1:z.name<V.name?-1:0})})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},q=r=>{try{y.dialog({title:`Editar Zona ${r.nameSubZone}`,message:"Cambia nombre de la zona",prompt:{model:r.nameSubZone,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(V=>V.idZone===t.value),z=s.value[_].subZone.findIndex(V=>V.idSubZone===n.value);s.value[_].subZone[z].nameSubZone=I(u.toLowerCase()),s.value[_].subZone.sort(function(V,oe){return V.nameSubZone>oe.nameSubZone?1:V.nameSubZone<oe.nameSubZone?-1:0}),d.value=s.value[_].subZone})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},E=()=>{try{let r=s.value.findIndex(u=>u.idZone===t.value);B.value.push(s.value[r]),s.value.splice(r,1),p.value="",d.value=[],t.value=-1}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},O=()=>{try{let r=s.value.findIndex(_=>_.idZone===t.value),u=s.value[r].subZone.findIndex(_=>_.idSubZone===n.value);C.value.push(s.value[r].subZone[u]),s.value[r].subZone.splice(u,1)}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},R=()=>{y.notify({message:"DEBE TENER AL MENOS UNA SUBZONA POR ZONA",type:"negative"})},G=()=>{if(s.value.find(u=>u.subZone.length===0))R();else{const u={modelZones:s.value,deletedZone:B.value,deletedSubZone:C.value};F(u)}};return _e(()=>{try{if(e.simple){const r=e.simple;s.value=[],r.forEach(u=>{var _;s.value.push({name:u.label,idZone:u.idZone,subZone:(_=u.children)==null?void 0:_.map(z=>({idZone:u.idZone,idSubZone:z.idSubZone,nameSubZone:z.label}))})})}}catch{}}),{dialogRef:P,active:t,modelZones:s,modelLabelZone:p,activeSubZone:n,modelLabelSubZone:v,modelDisable:k,modelSubZones:d,onDialogHide:Q,onOKClick(){},onCancelClick:A,prompt:T,addZone:b,selectZone:K,deleteZone:E,promptSubZone:H,addSubZone:h,selectSubZone:S,deleteSubZone:O,editZone:D,editSubZone:q,verificarSubZonas:G}}},Te=e=>(We("data-v-37d33233"),e=e(),$e(),e),mt={class:"my-card q-ma-sm"},ft=Te(()=>Z("div",{class:"text-h6"},"ZONAS",-1)),pt=$(" A\xF1adir"),vt=$("Eliminar"),bt={key:0,class:"q-pa-sm"},gt={class:"row justify-between"},ht=Te(()=>Z("div",{class:"text-h6"},"SUBZONAS",-1)),yt={class:"text-h8 self-end text-warning text-bold"},_t=$(" A\xF1adir"),Zt=$("Eliminar"),kt={class:"q-pa-sm"};function St(e,a,y,t,s,p){return x(),U(Ve,{ref:"dialogRef",onHide:t.onDialogHide},{default:c(()=>[l(ne,{class:"q-dialog-plugin card-principal"},{default:c(()=>[Z("div",mt,[l(ne,{class:"zone"},{default:c(()=>[l(ee,{class:"bg-primary text-white"},{default:c(()=>[ft]),_:1}),l(ie,{align:"around"},{default:c(()=>[l(L,{icon:"fa-regular fa-square-plus",flat:"",style:{"line-height":"1.5rem"},onClick:t.prompt},{default:c(()=>[pt]),_:1},8,["onClick"]),l(L,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteZone,style:{"line-height":"1.5rem"}},{default:c(()=>[vt]),_:1},8,["onClick"])]),_:1}),l(Y),l(ee,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[t.modelZones?(x(),J("div",bt,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),J(se,null,pe(t.modelZones,n=>ve((x(),U(Ie,{key:n,clickable:"",active:t.active===n.idZone,onClick:d=>t.selectZone(n),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(X,{avatar:""},{default:c(()=>[l(j,{color:"warning",name:"fa-solid fa-map-location-dot"})]),_:1}),l(X,null,{default:c(()=>[$(re(n.name),1)]),_:2},1024),l(X,{avatar:""},{default:c(()=>[l(j,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editZone(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])):be("",!0)]),_:1})]),_:1})]),_:1}),l(Y,{vertical:""}),l(ne,{class:"subzone"},{default:c(()=>[l(ee,{class:"bg-primary text-white"},{default:c(()=>[Z("div",gt,[ht,Z("div",yt," Zona: "+re(t.modelLabelZone),1)])]),_:1}),l(ie,{align:"around"},{default:c(()=>[l(L,{icon:"fa-regular fa-square-plus",flat:"",disable:t.modelDisable,style:{"line-height":"1.5rem"},onClick:t.promptSubZone},{default:c(()=>[_t]),_:1},8,["disable","onClick"]),l(L,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteSubZone,style:{"line-height":"1.5rem"}},{default:c(()=>[Zt]),_:1},8,["onClick"])]),_:1}),l(Y),l(ee,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[Z("div",kt,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),J(se,null,pe(t.modelSubZones,n=>ve((x(),U(Ie,{key:n,clickable:"",active:t.activeSubZone===n.idSubZone,onClick:d=>t.selectSubZone(n),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(X,{avatar:""},{default:c(()=>[l(j,{color:"warning",name:"fa-solid fa-location-dot"})]),_:1}),l(X,null,{default:c(()=>[$(re(n.nameSubZone),1)]),_:2},1024),l(X,{avatar:""},{default:c(()=>[l(j,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editSubZone(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])]),_:1})]),_:1})]),_:1})]),l(Y),l(ie,{align:"right"},{default:c(()=>[l(L,{color:"primary",label:"OK",onClick:t.verificarSubZonas},null,8,["onClick"]),l(L,{color:"primary",label:"Cancel",onClick:t.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var Ct=de(ct,[["render",St],["__scopeId","data-v-37d33233"]]),xe=qe({name:"QInnerLoading",props:{...Ee,...He,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:a}){const y=ye(),t=ze(e,y.proxy.$q),{transition:s,transitionStyle:p}=Ke(e,M(()=>e.showing)),n=M(()=>"q-inner-loading absolute-full column flex-center"+(t.value===!0?" q-inner-loading--dark":"")),d=M(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function v(){const C=[W(Je,{size:e.size,color:e.color})];return e.label!==void 0&&C.push(W("div",{class:d.value,style:e.labelStyle},[e.label])),C}function k(){return e.showing===!0?W("div",{class:n.value,style:p.value},a.default!==void 0?a.default():v()):null}return()=>W(Ye,{name:s.value,appear:!0},k)}});const Dt=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],wt=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],It={emits:["onUpdate"],props:{show:{type:String,required:!0},selected:{type:Object,required:!1}},setup(e,a){const y=f(!1),t=f(!1),s=f(""),p=f(""),n=f(10),d=f([]),v=f([]);f([]);const k=f([]),C=f([]),B=f(null),P=f([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),Q=()=>{try{C.value.length>0&&(d.value=C.value.filter(S=>S.item_prefijo===B.value.value))}catch(S){console.log("mark:EDDA40AD3C64",S)}},F=(S,b)=>{y.value=S,t.value=b!=="0"},A=async S=>{try{C.value=S,d.value=[],d.value=C.value.filter(b=>b.item_prefijo==="(I)"),d.value.length>0&&(y.value=!1)}catch(b){console.log("mark:EDDA40AD3C64",b)}},I=async(S,b,h)=>{try{let D=[];h==="2"&&(v.value=[],k.value=S,k.value.forEach(q=>{let E=d.value.findIndex(O=>O.item_id===q.item_id);E!==-1&&d.value.splice(E,1)}),v.value=k.value.filter(q=>q.idSubZone===b),a.emit("onUpdate",k.value))}catch(D){console.log("mark:EDDA40AD3C64",D)}},T=async(S,b)=>{try{let h=[];if(b==="2"){v.value=[];const D={pls_plz_pli_id:`eq.${S}`,select:"*"},q=await he.getItemsTemplate(D);q.success===1&&(h=q.originalResponse.body),C.value.map(E=>{let O=-1;for(let R=0,G=h.length;R<G;R++){if(h[R].item===parseInt(E.item_id)){k.value.push({idTemplate:h[R].pls_plz_pli_id,idZone:h[R].pls_plz_id,idSubZone:h[R].pls_id,item_id:E.item_id,item_descripcion:E.item_descripcion});let r=d.value.findIndex(u=>u.item_id===E.item_id);r!==-1&&d.value.splice(r,1)}v.value=k.value.filter(r=>r.idSubZone===e.selected.idSubZone)}}),t.value=!1,a.emit("onUpdate",k.value)}}catch(h){console.log("mark:EDDA40AD3C64",h)}},H=(S,b)=>{try{d.value.push(b),d.value.sort(function(D,q){return D.item_descripcion>q.item_descripcion?1:D.item_descripcion<q.item_descripcion?-1:0});let h=v.value.findIndex(D=>D.item_id===b.item_id);h!==-1&&v.value.splice(h,1),a.emit("onUpdate",v.value)}catch(h){console.log("mark:04AD35E5A5CF",h)}},K=(S,b)=>{try{if(e.selected){const h={item_id:b.item_id,item_descripcion:b.item_descripcion},D={...e.selected,...h};v.value.push(D),k.value.push(D),v.value.sort(function(E,O){return E.item_descripcion>O.item_descripcion?1:E.item_descripcion<O.item_descripcion?-1:0});let q=d.value.findIndex(E=>E.item_id===h.item_id);q!==-1&&d.value.splice(q,1),a.emit("onUpdate",k.value)}}catch(h){console.log("mark:04AD35E5A5CF",h)}};return _e(async()=>{}),me(()=>e.selected,(S,b)=>{v.value=k.value.filter(h=>h.idSubZone===e.selected.idSubZone)}),{columnsDb:Dt,rowsDb:d,tipo:B,options:P,rowsTemp:v,columnsTemp:wt,loading2:t,filterTemp:p,pagination:f({rowsPerPage:0}),visibleColumns:f(["insumo"]),loading:y,filter:s,rowCount:n,filterType:Q,passData:K,restoreData:H,generarLista:A,generarTempLista:T,generarImportLista:I,loadingList:F}}},xt={class:"row q-pa-sm justify-between section"},qt={style:{width:"49%"}},Et={style:{"margin-right":"1rem",width:"130px"}},zt={style:{width:"49%"}},Vt={class:"row justify-start"};function Ft(e,a,y,t,s,p){return x(),J("div",xt,[Z("div",qt,[l(De,{class:"my-sticky-header-table",title:"Treats",dense:"",rows:t.rowsDb,columns:t.columnsDb,"row-key":"idrest",filter:t.filter,loading:t.loading,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[4]||(a[4]=n=>t.pagination=n),"no-data-label":"No se ha cargado inforamci\xF3n","rows-per-page-options":[0],"visible-columns":t.visibleColumns,onRowDblclick:t.passData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),header:c(n=>[l(st,{props:n},{default:c(()=>[(x(!0),J(se,null,pe(n.cols,d=>(x(),U(it,{key:d.name,props:n,class:"text-italic text-white"},{default:c(()=>[$(re(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),top:c(()=>[Z("div",Et,[l(nt,{dark:"",dense:"",standout:"",modelValue:t.tipo,"onUpdate:modelValue":[a[0]||(a[0]=n=>t.tipo=n),a[1]||(a[1]=n=>t.filterType())],options:t.options,"display-value":`${t.tipo?t.tipo.label:"Insumo"}`},null,8,["modelValue","options","display-value"])]),Z("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filter,"onUpdate:modelValue":a[3]||(a[3]=n=>t.filter=n)},{append:c(()=>[t.filterTemp===""?(x(),U(j,{key:0,name:"search"})):(x(),U(j,{key:1,name:"clear",class:"cursor-pointer",onClick:a[2]||(a[2]=n=>t.filterTemp="")}))]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])]),Z("div",zt,[l(De,{class:"my-sticky-header-table",title:"Zone",dense:"",rows:t.rowsTemp,columns:t.columnsTemp,"row-key":"id",filter:t.filterTemp,loading:t.loading2,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[7]||(a[7]=n=>t.pagination=n),"rows-per-page-options":[0],"no-data-label":"I didn't find anything for you","visible-columns":t.visibleColumns,onRowDblclick:t.restoreData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),top:c(()=>[Z("div",Vt,[Z("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filterTemp,"onUpdate:modelValue":a[6]||(a[6]=n=>t.filterTemp=n),class:"q-ml-sm"},{append:c(()=>[t.filterTemp===""?(x(),U(j,{key:0,name:"search"})):(x(),U(j,{key:1,name:"clear",class:"cursor-pointer",onClick:a[5]||(a[5]=n=>t.filterTemp="")}))]),_:1},8,["modelValue"])])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])])])}var At=de(It,[["render",Ft]]);const Tt={emits:["import"],props:{},setup(e,a){let y=f(null);const t=p=>{let n=p.target.files||p.dataTransfer.files;!n.length||s(n[0])},s=p=>{let n=new FileReader;n.onload=d=>{let v=d.target.result;y.value=JSON.parse(v.toString()),a.emit("import",y.value)},n.readAsText(p)};return{prompt:f(!0),onFileChange:t,readFile:s}}},Lt={class:"q-pa-md q-gutter-sm"},Bt=Z("div",{class:"text-h6"},"Selecciona la Plantilla",-1),Ot={class:"",id:"app"};function Qt(e,a,y,t,s,p){return x(),J("div",Lt,[l(Ve,{modelValue:t.prompt,"onUpdate:modelValue":a[1]||(a[1]=n=>t.prompt=n),persistent:""},{default:c(()=>[l(ne,{style:{"min-width":"400px"}},{default:c(()=>[l(ee,null,{default:c(()=>[Bt]),_:1}),l(ee,{class:"q-pt-none"},{default:c(()=>[Z("div",Ot,[Z("input",{type:"file",accept:"application/json",onChange:a[0]||(a[0]=(...n)=>t.onFileChange&&t.onFileChange(...n))},null,32)])]),_:1}),l(ie,{align:"right",class:"text-primary"},{default:c(()=>[ve(l(L,{flat:"",label:"Cerrar"},null,512),[[ot]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Rt=de(Tt,[["render",Qt]]);const Ut=Ge({name:"NewInventoryTemplate",props:{show:{type:String,required:!1},templateId:{type:String,required:!1},templateName:{type:String,required:!1}},emits:[...le.emits],components:{DualListBoxComponent:At,ImportDataModel:Rt},setup(e){const a=Fe(),y=Xe(),t=f(""),s=f(null),p=f([]),n=f(""),d=f([]),v=f(null),k=f(null),C=f(!0),B=f(!1),P=f(!1),Q=f([]);let F="";const A=f(""),{supabase:I}=dt();f([]);const T=f([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),H=()=>{try{a.dialog({title:"Confirmar",message:"Esta seguro que desea salir, es posible que no haya guardado",cancel:!0,persistent:!0}).onOk(()=>{y.go(-1)}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}catch(o){console.log("mark:EF7259BC17FC",o)}},K=o=>{for(let i=0;i<d.value.length;i++)for(let m=0;m<o.length;m++)d.value[i].idZone===o[m].idZone&&(console.log(i),d.value.splice(i,1),i=0)},S=o=>{for(let i=0;i<d.value.length;i++)for(let m=0;m<o.length;m++)d.value[i].idSubZone===o[m].idSubZone&&(console.log(i),d.value.splice(i,1),i=0)},b=()=>{try{a.dialog({component:Ct,componentProps:{simple:p.value}}).onOk(o=>{o.deletedZone.length>0&&K(o.deletedZone),o.deletedSubZone.length>0&&S(o.deletedSubZone),G(o.modelZones)}).onCancel(()=>{console.log("Cancel")})}catch(o){console.log("mark:162AD26EBCEE",o)}},h=(o,i)=>{let m=[];return o.forEach(g=>{g.plz_id===i&&m.push({label:g.description,idZone:g.plz_id,idSubZone:g.pls_id,icon:"fa-solid fa-location-dot",type:"child",selectable:!0})}),m},D=async o=>{var i;if(B.value=!1,o.length>0){p.value=o[0].simple;const m=o[0].list.map(w=>({idTemplate:void 0,idZone:w.idZone,idSubZone:w.idSubZone,item_id:w.item_id,item_descripcion:w.item_descripcion}));console.log("arr",m);const g=p.value[0];n.value=g.children[0].idSubZone,O(n.value),await((i=s.value)==null?void 0:i.generarImportLista(m,g.children[0].idSubZone,"2"))}},q=()=>{const o=[{simple:p.value,list:d.value}],i=JSON.stringify(o),m=new Blob([i],{type:"text/plain"}),g=document.createEvent("MouseEvents"),w=document.createElement("a");w.download="test.json",w.href=window.URL.createObjectURL(m),w.dataset.downloadurl=["text/json",w.download,w.href].join(":"),g.initEvent("click",!0,!1),w.dispatchEvent(g)},E=async o=>{try{let i=!1;const m={store:"6",dateInv:rt().format("YYYY-MM-DD%20HH:mm:00"),select:"*"};if(o!=="0"&&o!==""){if(Q.value.length===0){for(let g=0;g<T.value.length;g++){const w=await he.getRestaurantItems(m,T.value[g].dbVal);if(w.success===1){i=!0;const te=w.originalResponse.body.data;te.length>0&&te&&te.forEach(ue=>{Q.value.push(ue)})}}return P.value=!0,i}}else return i}catch(i){console.log("mark:EDDA40AD3C64",i)}};_e(async()=>{var o,i;try{if(s.value.loadingList(!0,e.show),await E("1"),await((o=s.value)==null?void 0:o.generarLista(Q.value)),e.show==="0")p.value=[],t.value="0";else if(e.show==="1"){A.value=e.templateName,t.value="1";let m=await I.from("bizTemplateZone").select().eq("PLI_Id",e.templateId),g=await I.from("biztemplatesubzone").select().eq("plz_pli_id",e.templateId),w=m.data.sort(function(N,ae){return N.Description>ae.Description?1:N.Description<ae.Description?-1:0}),te=g.data.sort(function(N,ae){return N.Description>ae.Description?1:N.Description<ae.Description?-1:0});p.value=[],w.forEach(N=>{p.value.push({label:N.Description,idZone:N.PLZ_Id,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:h(te,N.PLZ_Id)})});const ue=p.value[0];n.value=ue.children[0].idSubZone,O(n.value),await((i=s.value)==null?void 0:i.generarTempLista(e.templateId,"2"))}else y.push("/managerinventorytemplate");console.log("respose",P.value)}catch(m){console.log("mark:4B67FB683345",m)}});const O=o=>{o&&p.value.forEach(i=>{const m=i.children.find(g=>g.idSubZone===o);m&&(v.value={idTemplate:e.templateId,idZone:m.idZone,idSubZone:m.idSubZone},k.value={Zone:i.label,SubZone:m.label})})},R=({node:o,key:i,done:m,fail:g})=>{if(o.length<1){m([]);return}m=p.value,console.log(m,"done")},G=async o=>{try{o&&(t.value="1",p.value=[],o.forEach(i=>{var m;p.value.push({label:i.name,idZone:i.idZone,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:(m=i.subZone)==null?void 0:m.map(g=>({label:g.nameSubZone,idZone:i.idZone,idSubZone:g.idSubZone,icon:"fa-solid fa-location-dot",type:"child",selectable:!0}))})}))}catch(i){console.log("mark:162AD26EBCEE",i)}},r=()=>!A.value||A.value===""?(F="Debe arregar una descripcion a la plantilla",!1):!0,u=()=>p.value.length===0?(F="Faltan datos en las zonas y subzonas",!1):!0,_=()=>d.value.length===0?(F="Debe arregar al menos un elemento a la plantilla",!1):!0,z=async o=>{if((await I.from("bizTemplateZone").select("PLI_Id").eq("PLI_Id",o)).data.length>0){const{data:m,error:g}=await I.from("bizTemplateZone").delete().eq("PLI_Id",o);return g?(console.log(g),a.notify({position:"top",multiLine:!0,type:"negative",message:`No se han actualizado los datos ${g}`}),!1):!0}else return!0},V=async()=>{try{const o=fe(),i={Id:o,Description:A.value,Comment:"",ReadOnly:!1,System:!1},m=await he.createInventoryTemplate(i);return o}catch(o){console.log("mark:E2D87765FE56",o)}},oe=async o=>{try{const i=p.value.map(g=>({PLI_Id:o,PLZ_Id:g.idZone,Description:g.label})),{error:m}=await I.from("bizTemplateZone").insert(i);m&&console.log(m)}catch(i){console.log("mark:E2D87765FE56",i)}},Le=async o=>{try{let i=[];p.value.forEach(g=>{g.children.map(w=>{i.push({plz_pli_id:o,plz_id:w.idZone,pls_id:w.idSubZone,description:w.label})})});const{error:m}=await I.from("biztemplatesubzone").insert(i);m&&console.log(m)}catch(i){console.log("mark:E2D87765FE56",i)}},Be=async o=>{try{let i=[];d.value.forEach(g=>{i.push({pls_plz_pli_id:o,pls_plz_id:g.idZone,pls_id:g.idSubZone,item:parseInt(g.item_id)})});const{error:m}=await I.from("biztemplateitem").insert(i);m&&console.log(m)}catch(i){console.log("mark:E2D87765FE56",i)}},Oe=o=>{a.notify({position:"top",type:"negative",message:o})},Qe=async()=>{try{if(r()&&u()&&_()){const o=d.value[0].idTemplate?d.value[0].idTemplate:await V();await z(o)&&(await oe(o),await Le(o),await Be(o),a.notify({position:"top",type:"positive",message:`Se ha creado la plantila ${A.value}`}),y.push("/managerinventorytemplate"))}else Oe(F),F=""}catch(o){console.log("mark:ADB5994C7B4B",o)}},Re=o=>{d.value=o,console.log("listitems",o)};return{splitterModel:f(25),modelDescription:A,listItems:d,expanded:C,showImport:B,treeData:v,selected:n,breadcumData:k,simple:p,visible:t,dualList:s,showZone:b,checkData:G,toBack:H,updateSelected:O,onUpdateItems:Re,saveAll:Qe,exportData:q,onImportData:D,onLazyLoad:R}}}),jt={class:"q-pa-sm"},Pt=$(" Obligatorio "),Nt={class:"q-pa-md"},Mt={class:"q-pa-sm container"};function Wt(e,a,y,t,s,p){const n=ke("DualListBoxComponent"),d=ke("ImportDataModel");return x(),J(se,null,[Z("div",jt,[Z("div",null,[l(et,{class:"bg-primary q-mb-md text-white",style:{"padding-top":"0.5rem"}},{default:c(()=>[l(L,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Guardar",onClick:a[0]||(a[0]=v=>e.saveAll()),icon:"fa-regular fa-floppy-disk",style:{"line-height":"1.5rem"}}),l(L,{flat:"",stack:"",size:"12px","no-caps":"",label:"Eliminar",icon:"fa-regular fa-trash-can",style:{"line-height":"1.5rem"}}),l(Y,{vertical:"",color:"warning",inset:""}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",onClick:a[1]||(a[1]=v=>e.showZone()),onOk:a[2]||(a[2]=v=>e.checkData()),label:"Editar Zonas",icon:"fa-solid fa-map-location-dot",style:{"line-height":"1.5rem"}}),l(Y,{vertical:"",inset:"",color:"warning"}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Importar",onClick:a[3]||(a[3]=v=>e.showImport=!0),icon:"fa-solid fa-file-import",style:{"line-height":"1.5rem"}}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",label:"Exportar",onClick:a[4]||(a[4]=v=>e.exportData()),icon:"fa-solid fa-file-export",style:{"line-height":"1.5rem"},disable:!e.templateId},null,8,["disable"]),l(Y,{vertical:"",inset:"",color:"warning"}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",label:"Atras",onClick:e.toBack,icon:"fa-regular fa-hand-point-left",style:{"line-height":"1.5rem"}},null,8,["onClick"])]),_:1})]),Z("div",null,[Z("div",null,[l(ut,{modelValue:e.splitterModel,"onUpdate:modelValue":a[9]||(a[9]=v=>e.splitterModel=v)},{before:c(()=>[Z("div",null,[l(ge,{"bottom-slots":"",modelValue:e.modelDescription,"onUpdate:modelValue":a[6]||(a[6]=v=>e.modelDescription=v),label:"Descripcion",rounded:""},{prepend:c(()=>[l(j,{name:"place"})]),append:c(()=>[l(j,{name:"close",onClick:a[5]||(a[5]=v=>e.modelDescription=""),class:"cursor-pointer"})]),hint:c(()=>[Pt]),_:1},8,["modelValue"])]),Z("div",Nt,[l(tt,{nodes:e.simple,accordion:"","node-key":"idSubZone","label-key":"label","selected-color":"primary",selected:e.selected,"onUpdate:selected":[a[7]||(a[7]=v=>e.selected=v),e.updateSelected]},null,8,["nodes","selected","onUpdate:selected"])])]),after:c(()=>[e.breadcumData?(x(),U(at,{key:0,class:"q-px-md text-orange"},{default:c(()=>[l(Se,{label:e.breadcumData.Zone,icon:"fa-solid fa-map-location-dot"},null,8,["label"]),l(Se,{label:e.breadcumData.SubZone,icon:"fa-solid fa-location-dot"},null,8,["label"])]),_:1})):be("",!0),Z("div",Mt,[l(n,{ref:"dualList",modelValue:e.listItems,"onUpdate:modelValue":a[8]||(a[8]=v=>e.listItems=v),selected:e.treeData,show:e.visible,onOnUpdate:e.onUpdateItems},null,8,["modelValue","selected","show","onOnUpdate"])])]),_:1},8,["modelValue"])])])]),e.showImport?(x(),U(d,{key:0,onImport:e.onImportData},null,8,["onImport"])):be("",!0)],64)}var na=de(Ut,[["render",Wt]]);export{na as default};
