import{C as qe,S as Ee,U as ze,r as m,c as M,w as me,h as W,H as ce,az as Re,a1 as Ue,g as ye,J as je,bp as Ne,a0 as Pe,o as _e,bq as fe,l as x,s as U,t as c,d as l,n as k,z as ne,y as X,br as ie,Q as L,bl as Y,m as J,F as se,N as pe,ao as ve,av as Ze,aq as j,O as $,P as re,x as be,B as Ve,bs as Me,bt as We,ad as $e,ah as He,am as Ke,as as Ye,v as ge,k as Je,u as Ge,au as ke}from"./index.fbcfccda.js";import{Q as Xe}from"./QToolbar.f7890de0.js";import{Q as et,a as Se,b as tt}from"./QBreadcrumbs.e199446f.js";import{T as at,Q as Ce,C as lt}from"./ClosePopup.23db4900.js";import{b as ot,Q as De,I as he,a as nt,h as it}from"./verify.0fe536ab.js";import{u as Fe,Q as rt}from"./use-quasar.5df62001.js";import{g as we,f as Ie,Q as G}from"./QMenu.2ac3a81d.js";import{_ as de}from"./plugin-vue_export-helper.21dcd24c.js";import st from"./supabase.ef72f0d1.js";import"./QResizeObserver.1fe933b9.js";import"./index.2cf0d985.js";import"./index.41782cf5.js";var dt=qe({name:"QSplitter",props:{...Ee,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(e,{slots:a,emit:y}){const{proxy:{$q:t}}=ye(),s=ze(e,t),p=m(null),o={before:m(null),after:m(null)},d=M(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(s.value===!0?" q-splitter--dark":"")),v=M(()=>e.horizontal===!0?"height":"width"),Z=M(()=>e.reverse!==!0?"before":"after"),C=M(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function B(b){return(e.unit==="%"?b:Math.round(b))+e.unit}const N=M(()=>({[Z.value]:{[v.value]:B(e.modelValue)}}));let R,F,A,I,T;function H(b){if(b.isFirst===!0){const D=p.value.getBoundingClientRect()[v.value];R=e.horizontal===!0?"up":"left",F=e.unit==="%"?100:D,A=Math.min(F,C.value[1],Math.max(C.value[0],e.modelValue)),I=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:t.lang.rtl===!0?-1:1)*(e.unit==="%"?D===0?0:100/D:1),p.value.classList.add("q-splitter--active");return}if(b.isFinal===!0){T!==e.modelValue&&y("update:modelValue",T),p.value.classList.remove("q-splitter--active");return}const g=A+I*(b.direction===R?-1:1)*b.distance[e.horizontal===!0?"y":"x"];T=Math.min(F,C.value[1],Math.max(C.value[0],g)),o[Z.value].value.style[v.value]=B(T),e.emitImmediately===!0&&e.modelValue!==T&&y("update:modelValue",T)}const K=M(()=>[[at,H,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function S(b,g){b<g[0]?y("update:modelValue",g[0]):b>g[1]&&y("update:modelValue",g[1])}return me(()=>e.modelValue,b=>{S(b,C.value)}),me(()=>e.limits,()=>{je(()=>{S(e.modelValue,C.value)})}),()=>{const b=[W("div",{ref:o.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:N.value.before},ce(a.before)),W("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[Re("div",{class:"q-splitter__separator-area absolute-full"},ce(a.separator),"sep",e.disable!==!0,()=>K.value)]),W("div",{ref:o.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:N.value.after},ce(a.after))];return W("div",{class:d.value,ref:p},Ue(a.default,b))}}});function le(){const{emit:e,proxy:a}=ye(),y=m(null);function t(){y.value.show()}function s(){y.value.hide()}function p(d){e("ok",d),s()}function o(){e("hide")}return Object.assign(a,{show:t,hide:s}),{dialogRef:y,onDialogHide:o,onDialogOK:p,onDialogCancel:s}}const Ae=["ok","hide"];le.emits=Ae;le.emitsObject=Ne(Ae);const ut={props:{simple:{type:Object,required:!1}},emits:[...le.emits],setup(e,{emit:a}){const y=Fe(),t=m(0),s=m([]),p=m(""),o=m(0),d=m([]),v=m(""),Z=m(!0),C=m([]),B=m([]);Pe({noti:()=>{}});const{dialogRef:N,onDialogHide:R,onDialogOK:F,onDialogCancel:A}=le(),I=r=>{try{return r.replace(/^./,r[0].toUpperCase())}catch(u){console.log("mark : FW-FA5675C5CBD0",u)}},T=()=>{try{y.dialog({title:"A\xF1adir Zonas",message:"A\xF1ade el nombre de la zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{b(I(r.toLowerCase()))})}catch(r){console.log("mark : FW-8DD303A05CDF",r)}},H=()=>{try{y.dialog({title:"A\xF1adir Sub-Zonas",message:"A\xF1ade el nombre de la sub-zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{g(I(r.toLowerCase()))})}catch(r){console.log("mark : FW-55E3164DC593",r)}},K=r=>{try{Z.value=!1,t.value=r.idZone,p.value=r.name;let u=s.value.findIndex(_=>_.idZone===r.idZone);d.value=s.value[u].subZone}catch(u){console.log("mark : FW-DF749FC08A5A",u)}},S=r=>{try{o.value=r.idSubZone,v.value=r.nameSubZone}catch(u){console.log("mark : FW-2C36D976C391",u)}},b=r=>{try{s.value.push({idZone:fe(),name:r,subZone:[]}),s.value.sort(function(u,_){return u.name>_.name?1:u.name<_.name?-1:0})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},g=r=>{try{d.value=[],s.value.forEach((u,_)=>{u.idZone===t.value&&(s.value[_].subZone.push({idZone:u.idZone,idSubZone:fe(),nameSubZone:r}),s.value[_].subZone.sort(function(z,V){return z.nameSubZone>V.nameSubZone?1:z.nameSubZone<V.nameSubZone?-1:0}),d.value=s.value[_].subZone)})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},D=r=>{try{y.dialog({title:`Editar Zona ${r.name}`,message:"Cambia nombre de la zona",prompt:{model:r.name,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(z=>z.idZone===t.value);s.value[_].name=I(u.toLowerCase()),s.value.sort(function(z,V){return z.name>V.name?1:z.name<V.name?-1:0})})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},q=r=>{try{y.dialog({title:`Editar Zona ${r.nameSubZone}`,message:"Cambia nombre de la zona",prompt:{model:r.nameSubZone,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(V=>V.idZone===t.value),z=s.value[_].subZone.findIndex(V=>V.idSubZone===o.value);s.value[_].subZone[z].nameSubZone=I(u.toLowerCase()),s.value[_].subZone.sort(function(V,oe){return V.nameSubZone>oe.nameSubZone?1:V.nameSubZone<oe.nameSubZone?-1:0}),d.value=s.value[_].subZone})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},E=()=>{try{let r=s.value.findIndex(u=>u.idZone===t.value);B.value.push(s.value[r]),s.value.splice(r,1),p.value="",d.value=[],t.value=-1}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},O=()=>{try{let r=s.value.findIndex(_=>_.idZone===t.value),u=s.value[r].subZone.findIndex(_=>_.idSubZone===o.value);C.value.push(s.value[r].subZone[u]),s.value[r].subZone.splice(u,1)}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},Q=()=>{y.notify({message:"DEBE TENER AL MENOS UNA SUBZONA POR ZONA",type:"negative"})},ee=()=>{if(s.value.find(u=>u.subZone.length===0))Q();else{const u={modelZones:s.value,deletedZone:B.value,deletedSubZone:C.value};F(u)}};return _e(()=>{try{if(e.simple){const r=e.simple;s.value=[],r.forEach(u=>{var _;s.value.push({name:u.label,idZone:u.idZone,subZone:(_=u.children)==null?void 0:_.map(z=>({idZone:u.idZone,idSubZone:z.idSubZone,nameSubZone:z.label}))})}),console.log(s.value)}}catch{}}),{dialogRef:N,active:t,modelZones:s,modelLabelZone:p,activeSubZone:o,modelLabelSubZone:v,modelDisable:Z,modelSubZones:d,onDialogHide:R,onOKClick(){},onCancelClick:A,prompt:T,addZone:b,selectZone:K,deleteZone:E,promptSubZone:H,addSubZone:g,selectSubZone:S,deleteSubZone:O,editZone:D,editSubZone:q,verificarSubZonas:ee}}},Te=e=>(Me("data-v-34489e8c"),e=e(),We(),e),ct={class:"my-card q-ma-sm"},mt=Te(()=>k("div",{class:"text-h6"},"ZONAS",-1)),ft=$(" A\xF1adir"),pt=$("Eliminar"),vt={key:0,class:"q-pa-sm"},bt={class:"row justify-between"},gt=Te(()=>k("div",{class:"text-h6"},"SUBZONAS",-1)),ht={class:"text-h8 self-end text-warning text-bold"},yt=$(" A\xF1adir"),_t=$("Eliminar"),Zt={class:"q-pa-sm"};function kt(e,a,y,t,s,p){return x(),U(Ve,{ref:"dialogRef",onHide:t.onDialogHide},{default:c(()=>[l(ne,{class:"q-dialog-plugin card-principal"},{default:c(()=>[k("div",ct,[l(ne,{class:"zone"},{default:c(()=>[l(X,{class:"bg-primary text-white"},{default:c(()=>[mt]),_:1}),l(ie,{align:"around"},{default:c(()=>[l(L,{icon:"fa-regular fa-square-plus",flat:"",style:{"line-height":"1.5rem"},onClick:t.prompt},{default:c(()=>[ft]),_:1},8,["onClick"]),l(L,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteZone,style:{"line-height":"1.5rem"}},{default:c(()=>[pt]),_:1},8,["onClick"])]),_:1}),l(Y),l(X,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[t.modelZones?(x(),J("div",vt,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),J(se,null,pe(t.modelZones,o=>ve((x(),U(Ie,{key:o,clickable:"",active:t.active===o.idZone,onClick:d=>t.selectZone(o),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(G,{avatar:""},{default:c(()=>[l(j,{color:"warning",name:"fa-solid fa-map-location-dot"})]),_:1}),l(G,null,{default:c(()=>[$(re(o.name),1)]),_:2},1024),l(G,{avatar:""},{default:c(()=>[l(j,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editZone(o)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])):be("",!0)]),_:1})]),_:1})]),_:1}),l(Y,{vertical:""}),l(ne,{class:"subzone"},{default:c(()=>[l(X,{class:"bg-primary text-white"},{default:c(()=>[k("div",bt,[gt,k("div",ht,"Zona: "+re(t.modelLabelZone),1)])]),_:1}),l(ie,{align:"around"},{default:c(()=>[l(L,{icon:"fa-regular fa-square-plus",flat:"",disable:t.modelDisable,style:{"line-height":"1.5rem"},onClick:t.promptSubZone},{default:c(()=>[yt]),_:1},8,["disable","onClick"]),l(L,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteSubZone,style:{"line-height":"1.5rem"}},{default:c(()=>[_t]),_:1},8,["onClick"])]),_:1}),l(Y),l(X,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[k("div",Zt,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),J(se,null,pe(t.modelSubZones,o=>ve((x(),U(Ie,{key:o,clickable:"",active:t.activeSubZone===o.idSubZone,onClick:d=>t.selectSubZone(o),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(G,{avatar:""},{default:c(()=>[l(j,{color:"warning",name:"fa-solid fa-location-dot"})]),_:1}),l(G,null,{default:c(()=>[$(re(o.nameSubZone),1)]),_:2},1024),l(G,{avatar:""},{default:c(()=>[l(j,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editSubZone(o)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])]),_:1})]),_:1})]),_:1})]),l(Y),l(ie,{align:"right"},{default:c(()=>[l(L,{color:"primary",label:"OK",onClick:t.verificarSubZonas},null,8,["onClick"]),l(L,{color:"primary",label:"Cancel",onClick:t.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var St=de(ut,[["render",kt],["__scopeId","data-v-34489e8c"]]),xe=qe({name:"QInnerLoading",props:{...Ee,...$e,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:a}){const y=ye(),t=ze(e,y.proxy.$q),{transition:s,transitionStyle:p}=He(e,M(()=>e.showing)),o=M(()=>"q-inner-loading absolute-full column flex-center"+(t.value===!0?" q-inner-loading--dark":"")),d=M(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function v(){const C=[W(Ye,{size:e.size,color:e.color})];return e.label!==void 0&&C.push(W("div",{class:d.value,style:e.labelStyle},[e.label])),C}function Z(){return e.showing===!0?W("div",{class:o.value,style:p.value},a.default!==void 0?a.default():v()):null}return()=>W(Ke,{name:s.value,appear:!0},Z)}});const Ct=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],Dt=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],wt={emits:["onUpdate"],props:{show:{type:String,required:!0},selected:{type:Object,required:!1}},setup(e,a){const y=m(!1),t=m(!1),s=m(""),p=m(""),o=m(10),d=m([]),v=m([]);m([]);const Z=m([]),C=m([]),B=m(null),N=m([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),R=()=>{try{C.value.length>0&&(d.value=C.value.filter(S=>S.item_prefijo===B.value.value))}catch(S){console.log("mark:EDDA40AD3C64",S)}},F=(S,b)=>{y.value=S,t.value=b!=="0"},A=async S=>{try{C.value=S,d.value=[],d.value=C.value.filter(b=>b.item_prefijo==="(I)"),d.value.length>0&&(y.value=!1)}catch(b){console.log("mark:EDDA40AD3C64",b)}},I=async(S,b,g)=>{try{let D=[];g==="2"&&(v.value=[],Z.value=S,Z.value.forEach(q=>{let E=d.value.findIndex(O=>O.item_id===q.item_id);E!==-1&&d.value.splice(E,1)}),v.value=Z.value.filter(q=>q.idSubZone===b),a.emit("onUpdate",Z.value))}catch(D){console.log("mark:EDDA40AD3C64",D)}},T=async(S,b)=>{try{let g=[];if(b==="2"){v.value=[];const D={pls_plz_pli_id:`eq.${S}`,select:"*"},q=await he.getItemsTemplate(D);q.success===1&&(g=q.originalResponse.body),C.value.map(E=>{let O=-1;for(let Q=0,ee=g.length;Q<ee;Q++){if(g[Q].item===parseInt(E.item_id)){Z.value.push({idTemplate:g[Q].pls_plz_pli_id,idZone:g[Q].pls_plz_id,idSubZone:g[Q].pls_id,item_id:E.item_id,item_descripcion:E.item_descripcion});let r=d.value.findIndex(u=>u.item_id===E.item_id);r!==-1&&d.value.splice(r,1)}v.value=Z.value.filter(r=>r.idSubZone===e.selected.idSubZone)}}),t.value=!1,a.emit("onUpdate",Z.value)}}catch(g){console.log("mark:EDDA40AD3C64",g)}},H=(S,b)=>{try{d.value.push(b),d.value.sort(function(D,q){return D.item_descripcion>q.item_descripcion?1:D.item_descripcion<q.item_descripcion?-1:0});let g=v.value.findIndex(D=>D.item_id===b.item_id);g!==-1&&v.value.splice(g,1),a.emit("onUpdate",v.value)}catch(g){console.log("mark:04AD35E5A5CF",g)}},K=(S,b)=>{try{if(e.selected){const g={item_id:b.item_id,item_descripcion:b.item_descripcion},D={...e.selected,...g};v.value.push(D),Z.value.push(D),console.log("general",Z.value),v.value.sort(function(E,O){return E.item_descripcion>O.item_descripcion?1:E.item_descripcion<O.item_descripcion?-1:0});let q=d.value.findIndex(E=>E.item_id===g.item_id);q!==-1&&d.value.splice(q,1),a.emit("onUpdate",Z.value)}}catch(g){console.log("mark:04AD35E5A5CF",g)}};return _e(async()=>{}),me(()=>e.selected,(S,b)=>{v.value=Z.value.filter(g=>g.idSubZone===e.selected.idSubZone)}),{columnsDb:Ct,rowsDb:d,tipo:B,options:N,rowsTemp:v,columnsTemp:Dt,loading2:t,filterTemp:p,pagination:m({rowsPerPage:0}),visibleColumns:m(["insumo"]),loading:y,filter:s,rowCount:o,filterType:R,passData:K,restoreData:H,generarLista:A,generarTempLista:T,generarImportLista:I,loadingList:F}}},It={class:"row q-pa-sm justify-between section"},xt={style:{width:"49%"}},qt={style:{"margin-right":"1rem",width:"130px"}},Et={style:{width:"49%"}},zt={class:"row justify-start"};function Vt(e,a,y,t,s,p){return x(),J("div",It,[k("div",xt,[l(De,{class:"my-sticky-header-table",title:"Treats",dense:"",rows:t.rowsDb,columns:t.columnsDb,"row-key":"idrest",filter:t.filter,loading:t.loading,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[4]||(a[4]=o=>t.pagination=o),"no-data-label":"No se ha cargado inforamci\xF3n","rows-per-page-options":[0],"visible-columns":t.visibleColumns,onRowDblclick:t.passData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),header:c(o=>[l(rt,{props:o},{default:c(()=>[(x(!0),J(se,null,pe(o.cols,d=>(x(),U(nt,{key:d.name,props:o,class:"text-italic text-white"},{default:c(()=>[$(re(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),top:c(()=>[k("div",qt,[l(ot,{dark:"",dense:"",standout:"",modelValue:t.tipo,"onUpdate:modelValue":[a[0]||(a[0]=o=>t.tipo=o),a[1]||(a[1]=o=>t.filterType())],options:t.options,"display-value":`${t.tipo?t.tipo.label:"Insumo"}`},null,8,["modelValue","options","display-value"])]),k("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filter,"onUpdate:modelValue":a[3]||(a[3]=o=>t.filter=o)},{append:c(()=>[t.filterTemp===""?(x(),U(j,{key:0,name:"search"})):(x(),U(j,{key:1,name:"clear",class:"cursor-pointer",onClick:a[2]||(a[2]=o=>t.filterTemp="")}))]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])]),k("div",Et,[l(De,{class:"my-sticky-header-table",title:"Zone",dense:"",rows:t.rowsTemp,columns:t.columnsTemp,"row-key":"id",filter:t.filterTemp,loading:t.loading2,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[7]||(a[7]=o=>t.pagination=o),"rows-per-page-options":[0],"no-data-label":"I didn't find anything for you","visible-columns":t.visibleColumns,onRowDblclick:t.restoreData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),top:c(()=>[k("div",zt,[k("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filterTemp,"onUpdate:modelValue":a[6]||(a[6]=o=>t.filterTemp=o),class:"q-ml-sm"},{append:c(()=>[t.filterTemp===""?(x(),U(j,{key:0,name:"search"})):(x(),U(j,{key:1,name:"clear",class:"cursor-pointer",onClick:a[5]||(a[5]=o=>t.filterTemp="")}))]),_:1},8,["modelValue"])])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])])])}var Ft=de(wt,[["render",Vt]]);const At={emits:["import"],props:{},setup(e,a){let y=m(null);const t=p=>{let o=p.target.files||p.dataTransfer.files;!o.length||s(o[0])},s=p=>{let o=new FileReader;o.onload=d=>{let v=d.target.result;y.value=JSON.parse(v.toString()),a.emit("import",y.value)},o.readAsText(p)};return{prompt:m(!0),onFileChange:t,readFile:s}}},Tt={class:"q-pa-md q-gutter-sm"},Lt=k("div",{class:"text-h6"},"Selecciona la Plantilla",-1),Bt={class:"",id:"app"};function Ot(e,a,y,t,s,p){return x(),J("div",Tt,[l(Ve,{modelValue:t.prompt,"onUpdate:modelValue":a[1]||(a[1]=o=>t.prompt=o),persistent:""},{default:c(()=>[l(ne,{style:{"min-width":"400px"}},{default:c(()=>[l(X,null,{default:c(()=>[Lt]),_:1}),l(X,{class:"q-pt-none"},{default:c(()=>[k("div",Bt,[k("input",{type:"file",accept:"application/json",onChange:a[0]||(a[0]=(...o)=>t.onFileChange&&t.onFileChange(...o))},null,32)])]),_:1}),l(ie,{align:"right",class:"text-primary"},{default:c(()=>[ve(l(L,{flat:"",label:"Cerrar"},null,512),[[lt]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Qt=de(At,[["render",Ot]]);const Rt=Je({name:"NewInventoryTemplate",props:{show:{type:String,required:!1},templateId:{type:String,required:!1},templateName:{type:String,required:!1}},emits:[...le.emits],components:{DualListBoxComponent:Ft,ImportDataModel:Qt},setup(e){const a=Fe(),y=Ge(),t=m(""),s=m(null),p=m([]),o=m(""),d=m([]),v=m(null),Z=m(null),C=m(!0),B=m(!1),N=m(!1),R=m([]);let F="";const A=m(""),{supabase:I}=st(),T=m([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),H=()=>{try{a.dialog({title:"Confirmar",message:"Esta seguro que desea salir, es posible que no haya guardado",cancel:!0,persistent:!0}).onOk(()=>{y.go(-1)}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}catch(n){console.log("mark:EF7259BC17FC",n)}},K=n=>{for(let i=0;i<d.value.length;i++)for(let f=0;f<n.length;f++)d.value[i].idZone===n[f].idZone&&(console.log(i),d.value.splice(i,1),i=0)},S=n=>{for(let i=0;i<d.value.length;i++)for(let f=0;f<n.length;f++)d.value[i].idSubZone===n[f].idSubZone&&(console.log(i),d.value.splice(i,1),i=0)},b=()=>{try{a.dialog({component:St,componentProps:{simple:p.value}}).onOk(n=>{n.deletedZone.length>0&&K(n.deletedZone),n.deletedSubZone.length>0&&S(n.deletedSubZone),Q(n.modelZones)}).onCancel(()=>{console.log("Cancel")})}catch(n){console.log("mark:162AD26EBCEE",n)}},g=(n,i)=>{let f=[];return n.forEach(h=>{h.plz_id===i&&f.push({label:h.description,idZone:h.plz_id,idSubZone:h.pls_id,icon:"fa-solid fa-location-dot",type:"child",selectable:!0})}),f},D=async n=>{var i;if(B.value=!1,n.length>0){p.value=n[0].simple;const f=n[0].list.map(w=>({idTemplate:void 0,idZone:w.idZone,idSubZone:w.idSubZone,item_id:w.item_id,item_descripcion:w.item_descripcion}));console.log("arr",f);const h=p.value[0];o.value=h.children[0].idSubZone,O(o.value),await((i=s.value)==null?void 0:i.generarImportLista(f,h.children[0].idSubZone,"2"))}},q=()=>{const n=[{simple:p.value,list:d.value}],i=JSON.stringify(n),f=new Blob([i],{type:"text/plain"}),h=document.createEvent("MouseEvents"),w=document.createElement("a");w.download="test.json",w.href=window.URL.createObjectURL(f),w.dataset.downloadurl=["text/json",w.download,w.href].join(":"),h.initEvent("click",!0,!1),w.dispatchEvent(h)},E=async n=>{try{let i=!1;const f={store:"6",dateInv:it().format("YYYY-MM-DD%20HH:mm:00"),select:"*"};if(n!=="0"&&n!==""){if(R.value.length===0){for(let h=0;h<T.value.length;h++){const w=await he.getRestaurantItems(f,T.value[h].dbVal);if(w.success===1){i=!0;const te=w.originalResponse.body.data;te.length>0&&te&&te.forEach(ue=>{R.value.push(ue)})}}return N.value=!0,i}}else return i}catch(i){console.log("mark:EDDA40AD3C64",i)}};_e(async()=>{var n,i;try{if(s.value.loadingList(!0,e.show),await E("1"),await((n=s.value)==null?void 0:n.generarLista(R.value)),e.show==="0")p.value=[],t.value="0";else if(e.show==="1"){A.value=e.templateName,t.value="1";let f=await I.from("bizTemplateZone").select().eq("PLI_Id",e.templateId),h=await I.from("biztemplatesubzone").select().eq("plz_pli_id",e.templateId),w=f.data.sort(function(P,ae){return P.Description>ae.Description?1:P.Description<ae.Description?-1:0}),te=h.data.sort(function(P,ae){return P.Description>ae.Description?1:P.Description<ae.Description?-1:0});p.value=[],w.forEach(P=>{p.value.push({label:P.Description,idZone:P.PLZ_Id,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:g(te,P.PLZ_Id)})});const ue=p.value[0];o.value=ue.children[0].idSubZone,O(o.value),await((i=s.value)==null?void 0:i.generarTempLista(e.templateId,"2"))}else y.push("/managerinventorytemplate");console.log("respose",N.value)}catch(f){console.log("mark:4B67FB683345",f)}});const O=n=>{n&&p.value.forEach(i=>{const f=i.children.find(h=>h.idSubZone===n);f&&(v.value={idTemplate:e.templateId,idZone:f.idZone,idSubZone:f.idSubZone},Z.value={Zone:i.label,SubZone:f.label})})},Q=async n=>{try{n&&(t.value="1",p.value=[],n.forEach(i=>{var f;p.value.push({label:i.name,idZone:i.idZone,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:(f=i.subZone)==null?void 0:f.map(h=>({label:h.nameSubZone,idZone:i.idZone,idSubZone:h.idSubZone,icon:"fa-solid fa-location-dot",type:"child",selectable:!0}))})}))}catch(i){console.log("mark:162AD26EBCEE",i)}},ee=()=>!A.value||A.value===""?(F="Debe arregar una descripcion a la plantilla",!1):!0,r=()=>p.value.length===0?(F="Faltan datos en las zonas y subzonas",!1):!0,u=()=>d.value.length===0?(F="Debe arregar al menos un elemento a la plantilla",!1):!0,_=async n=>{if((await I.from("bizTemplateZone").select("PLI_Id").eq("PLI_Id",n)).data.length>0){const{data:f,error:h}=await I.from("bizTemplateZone").delete().eq("PLI_Id",n);return h?(console.log(h),a.notify({position:"top",multiLine:!0,type:"negative",message:`No se han actualizado los datos ${h}`}),!1):!0}else return!0},z=async()=>{try{const n=fe(),i={Id:n,Description:A.value,Comment:"",ReadOnly:!1,System:!1},f=await he.createInventoryTemplate(i);return n}catch(n){console.log("mark:E2D87765FE56",n)}},V=async n=>{try{const i=p.value.map(h=>({PLI_Id:n,PLZ_Id:h.idZone,Description:h.label})),{error:f}=await I.from("bizTemplateZone").insert(i);f&&console.log(f)}catch(i){console.log("mark:E2D87765FE56",i)}},oe=async n=>{try{let i=[];p.value.forEach(h=>{h.children.map(w=>{i.push({plz_pli_id:n,plz_id:w.idZone,pls_id:w.idSubZone,description:w.label})})});const{error:f}=await I.from("biztemplatesubzone").insert(i);f&&console.log(f)}catch(i){console.log("mark:E2D87765FE56",i)}},Le=async n=>{try{let i=[];d.value.forEach(h=>{i.push({pls_plz_pli_id:n,pls_plz_id:h.idZone,pls_id:h.idSubZone,item:parseInt(h.item_id)})});const{error:f}=await I.from("biztemplateitem").insert(i);f&&console.log(f)}catch(i){console.log("mark:E2D87765FE56",i)}},Be=n=>{a.notify({position:"top",type:"negative",message:n})},Oe=async()=>{try{if(ee()&&r()&&u()){const n=d.value[0].idTemplate?d.value[0].idTemplate:await z();await _(n)&&(await V(n),await oe(n),await Le(n),a.notify({position:"top",type:"positive",message:`Se ha creado la plantila ${A.value}`}),y.push("/managerinventorytemplate"))}else Be(F),F=""}catch(n){console.log("mark:ADB5994C7B4B",n)}},Qe=n=>{d.value=n,console.log("listitems",n)};return{splitterModel:m(25),modelDescription:A,listItems:d,expanded:C,showImport:B,treeData:v,selected:o,breadcumData:Z,simple:p,visible:t,dualList:s,showZone:b,checkData:Q,toBack:H,updateSelected:O,onUpdateItems:Qe,saveAll:Oe,exportData:q,onImportData:D}}}),Ut={class:"q-pa-sm"},jt=$(" Obligatorio "),Nt={class:"q-pa-md"},Pt={class:"q-pa-sm container"};function Mt(e,a,y,t,s,p){const o=ke("DualListBoxComponent"),d=ke("ImportDataModel");return x(),J(se,null,[k("div",Ut,[k("div",null,[l(Xe,{class:"bg-primary q-mb-md text-white",style:{"padding-top":"0.5rem"}},{default:c(()=>[l(L,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Guardar",onClick:a[0]||(a[0]=v=>e.saveAll()),icon:"fa-regular fa-floppy-disk",style:{"line-height":"1.5rem"}}),l(L,{flat:"",stack:"",size:"12px","no-caps":"",label:"Eliminar",icon:"fa-regular fa-trash-can",style:{"line-height":"1.5rem"}}),l(Y,{vertical:"",color:"warning",inset:""}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",onClick:a[1]||(a[1]=v=>e.showZone()),onOk:a[2]||(a[2]=v=>e.checkData()),label:"Editar Zonas",icon:"fa-solid fa-map-location-dot",style:{"line-height":"1.5rem"}}),l(Y,{vertical:"",inset:"",color:"warning"}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Importar",onClick:a[3]||(a[3]=v=>e.showImport=!0),icon:"fa-solid fa-file-import",style:{"line-height":"1.5rem"}}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",label:"Exportar",onClick:a[4]||(a[4]=v=>e.exportData()),icon:"fa-solid fa-file-export",style:{"line-height":"1.5rem"},disable:!e.templateId},null,8,["disable"]),l(Y,{vertical:"",inset:"",color:"warning"}),l(L,{stack:"",flat:"",size:"12px","no-caps":"",label:"Atras",onClick:e.toBack,icon:"fa-regular fa-hand-point-left",style:{"line-height":"1.5rem"}},null,8,["onClick"])]),_:1})]),k("div",null,[k("div",null,[l(dt,{modelValue:e.splitterModel,"onUpdate:modelValue":a[9]||(a[9]=v=>e.splitterModel=v)},{before:c(()=>[k("div",null,[l(ge,{"bottom-slots":"",modelValue:e.modelDescription,"onUpdate:modelValue":a[6]||(a[6]=v=>e.modelDescription=v),label:"Descripcion",rounded:""},{prepend:c(()=>[l(j,{name:"place"})]),append:c(()=>[l(j,{name:"close",onClick:a[5]||(a[5]=v=>e.modelDescription=""),class:"cursor-pointer"})]),hint:c(()=>[jt]),_:1},8,["modelValue"])]),k("div",Nt,[l(et,{nodes:e.simple,accordion:"","node-key":"idSubZone","selected-color":"primary",selected:e.selected,"onUpdate:selected":[a[7]||(a[7]=v=>e.selected=v),e.updateSelected],"default-expand-all":""},null,8,["nodes","selected","onUpdate:selected"])])]),after:c(()=>[e.breadcumData?(x(),U(tt,{key:0,class:"q-px-md text-orange"},{default:c(()=>[l(Se,{label:e.breadcumData.Zone,icon:"fa-solid fa-map-location-dot"},null,8,["label"]),l(Se,{label:e.breadcumData.SubZone,icon:"fa-solid fa-location-dot"},null,8,["label"])]),_:1})):be("",!0),k("div",Pt,[l(o,{ref:"dualList",modelValue:e.listItems,"onUpdate:modelValue":a[8]||(a[8]=v=>e.listItems=v),selected:e.treeData,show:e.visible,onOnUpdate:e.onUpdateItems},null,8,["modelValue","selected","show","onOnUpdate"])])]),_:1},8,["modelValue"])])])]),e.showImport?(x(),U(d,{key:0,onImport:e.onImportData},null,8,["onImport"])):be("",!0)],64)}var oa=de(Rt,[["render",Mt]]);export{oa as default};
