import{y as qe,a5 as Ee,a6 as ze,r as m,c as M,w as pe,h as W,z as me,av as Pe,I as Me,g as ye,P as $e,bm as We,H as He,o as _e,bn as le,k as x,l as U,m as c,d as l,x as Z,s as ie,Q as ee,bo as re,q as A,bi as J,n as G,F as de,a1 as fe,ak as ve,ar as Ze,am as R,a2 as H,a3 as se,p as be,ai as Ve,bp as Ke,bq as Ye,a8 as Je,ac as Ge,ah as Xe,ao as et,S as ge,aU as Fe,u as tt,aq as ke}from"./index.cf0f49d2.js";import{Q as at}from"./QToolbar.29665bc0.js";import{Q as lt,a as Se,b as ot}from"./QBreadcrumbs.6dd2aa3f.js";import{T as nt,Q as Ce,C as it}from"./ClosePopup.a79f33ef.js";import{b as rt,Q as De,I as he,a as st,h as dt}from"./verify.9bb08a39.js";import{u as Ae,Q as ut}from"./use-quasar.f49fc05e.js";import{g as we,f as Ie,Q as X}from"./QMenu.3352f4a5.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import ct from"./supabase.3ceaf23e.js";import"./QResizeObserver.458075a7.js";import"./index.2cf0d985.js";import"./index.123dc0be.js";var mt=qe({name:"QSplitter",props:{...Ee,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(e,{slots:a,emit:y}){const{proxy:{$q:t}}=ye(),s=ze(e,t),f=m(null),n={before:m(null),after:m(null)},d=M(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(s.value===!0?" q-splitter--dark":"")),v=M(()=>e.horizontal===!0?"height":"width"),k=M(()=>e.reverse!==!0?"before":"after"),C=M(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function L(b){return(e.unit==="%"?b:Math.round(b))+e.unit}const j=M(()=>({[k.value]:{[v.value]:L(e.modelValue)}}));let O,B,T,q,I;function K(b){if(b.isFirst===!0){const D=f.value.getBoundingClientRect()[v.value];O=e.horizontal===!0?"up":"left",B=e.unit==="%"?100:D,T=Math.min(B,C.value[1],Math.max(C.value[0],e.modelValue)),q=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:t.lang.rtl===!0?-1:1)*(e.unit==="%"?D===0?0:100/D:1),f.value.classList.add("q-splitter--active");return}if(b.isFinal===!0){I!==e.modelValue&&y("update:modelValue",I),f.value.classList.remove("q-splitter--active");return}const h=T+q*(b.direction===O?-1:1)*b.distance[e.horizontal===!0?"y":"x"];I=Math.min(B,C.value[1],Math.max(C.value[0],h)),n[k.value].value.style[v.value]=L(I),e.emitImmediately===!0&&e.modelValue!==I&&y("update:modelValue",I)}const $=M(()=>[[nt,K,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function S(b,h){b<h[0]?y("update:modelValue",h[0]):b>h[1]&&y("update:modelValue",h[1])}return pe(()=>e.modelValue,b=>{S(b,C.value)}),pe(()=>e.limits,()=>{$e(()=>{S(e.modelValue,C.value)})}),()=>{const b=[W("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:j.value.before},me(a.before)),W("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[Pe("div",{class:"q-splitter__separator-area absolute-full"},me(a.separator),"sep",e.disable!==!0,()=>$.value)]),W("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:j.value.after},me(a.after))];return W("div",{class:d.value,ref:f},Me(a.default,b))}}});function oe(){const{emit:e,proxy:a}=ye(),y=m(null);function t(){y.value.show()}function s(){y.value.hide()}function f(d){e("ok",d),s()}function n(){e("hide")}return Object.assign(a,{show:t,hide:s}),{dialogRef:y,onDialogHide:n,onDialogOK:f,onDialogCancel:s}}const Te=["ok","hide"];oe.emits=Te;oe.emitsObject=We(Te);const pt={props:{simple:{type:Object,required:!1}},emits:[...oe.emits],setup(e,{emit:a}){const y=Ae(),t=m(0),s=m([]),f=m(""),n=m(0),d=m([]),v=m(""),k=m(!0),C=m([]),L=m([]);He({noti:()=>{}});const{dialogRef:j,onDialogHide:O,onDialogOK:B,onDialogCancel:T}=oe(),q=r=>{try{return r.replace(/^./,r[0].toUpperCase())}catch(u){console.log("mark : FW-FA5675C5CBD0",u)}},I=()=>{try{y.dialog({title:"A\xF1adir Zonas",message:"A\xF1ade el nombre de la zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{b(q(r.toLowerCase()))})}catch(r){console.log("mark : FW-8DD303A05CDF",r)}},K=()=>{try{y.dialog({title:"A\xF1adir Sub-Zonas",message:"A\xF1ade el nombre de la sub-zona",prompt:{model:"",isValid:r=>r.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(r=>{h(q(r.toLowerCase()))})}catch(r){console.log("mark : FW-55E3164DC593",r)}},$=r=>{try{k.value=!1,t.value=r.idZone,f.value=r.name;let u=s.value.findIndex(_=>_.idZone===r.idZone);d.value=s.value[u].subZone}catch(u){console.log("mark : FW-DF749FC08A5A",u)}},S=r=>{try{n.value=r.idSubZone,v.value=r.nameSubZone}catch(u){console.log("mark : FW-2C36D976C391",u)}},b=r=>{try{s.value.push({idZone:le(),name:r,subZone:[]}),s.value.sort(function(u,_){return u.name>_.name?1:u.name<_.name?-1:0})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},h=r=>{try{d.value=[],s.value.forEach((u,_)=>{u.idZone===t.value&&(s.value[_].subZone.push({idZone:u.idZone,idSubZone:le(),nameSubZone:r}),s.value[_].subZone.sort(function(V,F){return V.nameSubZone>F.nameSubZone?1:V.nameSubZone<F.nameSubZone?-1:0}),d.value=s.value[_].subZone)})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},D=r=>{try{y.dialog({title:`Editar Zona ${r.name}`,message:"Cambia nombre de la zona",prompt:{model:r.name,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(V=>V.idZone===t.value);s.value[_].name=q(u.toLowerCase()),s.value.sort(function(V,F){return V.name>F.name?1:V.name<F.name?-1:0})})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},E=r=>{try{y.dialog({title:`Editar Zona ${r.nameSubZone}`,message:"Cambia nombre de la zona",prompt:{model:r.nameSubZone,isValid:u=>u.length>2,type:"text"},cancel:!0,persistent:!0}).onOk(u=>{let _=s.value.findIndex(F=>F.idZone===t.value),V=s.value[_].subZone.findIndex(F=>F.idSubZone===n.value);s.value[_].subZone[V].nameSubZone=q(u.toLowerCase()),s.value[_].subZone.sort(function(F,ne){return F.nameSubZone>ne.nameSubZone?1:F.nameSubZone<ne.nameSubZone?-1:0}),d.value=s.value[_].subZone})}catch(u){console.log("mark : FW-7A0CF65B8CBE",u)}},z=()=>{try{let r=s.value.findIndex(u=>u.idZone===t.value);L.value.push(s.value[r]),s.value.splice(r,1),f.value="",d.value=[],t.value=-1}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},N=()=>{try{let r=s.value.findIndex(_=>_.idZone===t.value),u=s.value[r].subZone.findIndex(_=>_.idSubZone===n.value);C.value.push(s.value[r].subZone[u]),s.value[r].subZone.splice(u,1)}catch(r){console.log("mark : FW-DE66FFFD1FE4",r)}},Q=()=>{y.notify({message:"DEBE TENER AL MENOS UNA SUBZONA POR ZONA",type:"negative"})},Y=()=>{if(s.value.find(u=>u.subZone.length===0))Q();else{const u={modelZones:s.value,deletedZone:L.value,deletedSubZone:C.value};B(u)}};return _e(()=>{try{if(e.simple){const r=e.simple;s.value=[],r.forEach(u=>{var _;s.value.push({name:u.label,idZone:u.idZone,subZone:(_=u.children)==null?void 0:_.map(V=>({idZone:u.idZone,idSubZone:V.idSubZone,nameSubZone:V.label}))})})}}catch{}}),{dialogRef:j,active:t,modelZones:s,modelLabelZone:f,activeSubZone:n,modelLabelSubZone:v,modelDisable:k,modelSubZones:d,onDialogHide:O,onOKClick(){},onCancelClick:T,prompt:I,addZone:b,selectZone:$,deleteZone:z,promptSubZone:K,addSubZone:h,selectSubZone:S,deleteSubZone:N,editZone:D,editSubZone:E,verificarSubZonas:Y}}},Le=e=>(Ke("data-v-d4c5f4e8"),e=e(),Ye(),e),ft={class:"my-card q-ma-sm"},vt=Le(()=>Z("div",{class:"text-h6"},"ZONAS",-1)),bt=H(" A\xF1adir"),gt=H("Eliminar"),ht={key:0,class:"q-pa-sm"},yt={class:"row justify-between"},_t=Le(()=>Z("div",{class:"text-h6"},"SUBZONAS",-1)),Zt={class:"text-h8 self-end text-warning text-bold"},kt=H(" A\xF1adir"),St=H("Eliminar"),Ct={class:"q-pa-sm"};function Dt(e,a,y,t,s,f){return x(),U(Ve,{ref:"dialogRef",onHide:t.onDialogHide},{default:c(()=>[l(ie,{class:"q-dialog-plugin card-principal"},{default:c(()=>[Z("div",ft,[l(ie,{class:"zone"},{default:c(()=>[l(ee,{class:"bg-primary text-white"},{default:c(()=>[vt]),_:1}),l(re,{align:"around"},{default:c(()=>[l(A,{icon:"fa-regular fa-square-plus",flat:"",style:{"line-height":"1.5rem"},onClick:t.prompt},{default:c(()=>[bt]),_:1},8,["onClick"]),l(A,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteZone,style:{"line-height":"1.5rem"}},{default:c(()=>[gt]),_:1},8,["onClick"])]),_:1}),l(J),l(ee,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[t.modelZones?(x(),G("div",ht,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),G(de,null,fe(t.modelZones,n=>ve((x(),U(Ie,{key:n,clickable:"",active:t.active===n.idZone,onClick:d=>t.selectZone(n),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(X,{avatar:""},{default:c(()=>[l(R,{color:"warning",name:"fa-solid fa-map-location-dot"})]),_:1}),l(X,null,{default:c(()=>[H(se(n.name),1)]),_:2},1024),l(X,{avatar:""},{default:c(()=>[l(R,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editZone(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])):be("",!0)]),_:1})]),_:1})]),_:1}),l(J,{vertical:""}),l(ie,{class:"subzone"},{default:c(()=>[l(ee,{class:"bg-primary text-white"},{default:c(()=>[Z("div",yt,[_t,Z("div",Zt," Zona: "+se(t.modelLabelZone),1)])]),_:1}),l(re,{align:"around"},{default:c(()=>[l(A,{icon:"fa-regular fa-square-plus",flat:"",disable:t.modelDisable,style:{"line-height":"1.5rem"},onClick:t.promptSubZone},{default:c(()=>[kt]),_:1},8,["disable","onClick"]),l(A,{icon:"fa-regular fa-square-minus",flat:"",onClick:t.deleteSubZone,style:{"line-height":"1.5rem"}},{default:c(()=>[St]),_:1},8,["onClick"])]),_:1}),l(J),l(ee,null,{default:c(()=>[l(Ce,{style:{height:"200px"}},{default:c(()=>[Z("div",Ct,[l(we,{bordered:"",separator:""},{default:c(()=>[(x(!0),G(de,null,fe(t.modelSubZones,n=>ve((x(),U(Ie,{key:n,clickable:"",active:t.activeSubZone===n.idSubZone,onClick:d=>t.selectSubZone(n),"active-class":"bg-teal-1 text-grey-8"},{default:c(()=>[l(X,{avatar:""},{default:c(()=>[l(R,{color:"warning",name:"fa-solid fa-location-dot"})]),_:1}),l(X,null,{default:c(()=>[H(se(n.nameSubZone),1)]),_:2},1024),l(X,{avatar:""},{default:c(()=>[l(R,{color:"cyan-5",size:"18px",name:"fa-regular fa-pen-to-square",onClick:d=>t.editSubZone(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Ze]])),128))]),_:1})])]),_:1})]),_:1})]),_:1})]),l(J),l(re,{align:"right"},{default:c(()=>[l(A,{color:"primary",label:"OK",onClick:t.verificarSubZonas},null,8,["onClick"]),l(A,{color:"primary",label:"Cancel",onClick:t.onCancelClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var wt=ue(pt,[["render",Dt],["__scopeId","data-v-d4c5f4e8"]]),xe=qe({name:"QInnerLoading",props:{...Ee,...Je,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:a}){const y=ye(),t=ze(e,y.proxy.$q),{transition:s,transitionStyle:f}=Ge(e,M(()=>e.showing)),n=M(()=>"q-inner-loading absolute-full column flex-center"+(t.value===!0?" q-inner-loading--dark":"")),d=M(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function v(){const C=[W(et,{size:e.size,color:e.color})];return e.label!==void 0&&C.push(W("div",{class:d.value,style:e.labelStyle},[e.label])),C}function k(){return e.showing===!0?W("div",{class:n.value,style:f.value},a.default!==void 0?a.default():v()):null}return()=>W(Xe,{name:s.value,appear:!0},k)}});const It=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],xt=[{name:"idrest",label:"Id",align:"left",field:e=>e.item_id,format:e=>`${e}`,sortable:!0},{name:"insumo",required:!0,label:"Item",align:"left",field:e=>e.item_descripcion,format:e=>`${e}`,sortable:!0}],qt={emits:["onUpdate"],props:{show:{type:String,required:!0},selected:{type:Object,required:!1}},setup(e,a){const y=m(!1),t=m(!1),s=m(""),f=m(""),n=m(10),d=m([]),v=m([]);m([]);const k=m([]),C=m([]),L=m(null),j=m([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),O=()=>{try{C.value.length>0&&(d.value=C.value.filter(S=>S.item_prefijo===L.value.value))}catch(S){console.log("mark:EDDA40AD3C64",S)}},B=(S,b)=>{y.value=S,t.value=b!=="0"},T=async S=>{try{C.value=S,d.value=[],d.value=C.value.filter(b=>b.item_prefijo==="(I)"),d.value.length>0&&(y.value=!1)}catch(b){console.log("mark:EDDA40AD3C64",b)}},q=async(S,b,h)=>{try{let D=[];h==="2"&&(v.value=[],k.value=S,k.value.forEach(E=>{let z=d.value.findIndex(N=>N.item_id===E.item_id);z!==-1&&d.value.splice(z,1)}),v.value=k.value.filter(E=>E.idSubZone===b),a.emit("onUpdate",k.value))}catch(D){console.log("mark:EDDA40AD3C64",D)}},I=async(S,b)=>{try{let h=[];if(b==="2"){v.value=[];const D={pls_plz_pli_id:`eq.${S}`,select:"*"},E=await he.getItemsTemplate(D);E.success===1&&(h=E.originalResponse.body),C.value.map(z=>{let N=-1;for(let Q=0,Y=h.length;Q<Y;Q++){if(h[Q].item===parseInt(z.item_id)){k.value.push({idTemplate:h[Q].pls_plz_pli_id,idZone:h[Q].pls_plz_id,idSubZone:h[Q].pls_id,item_id:z.item_id,item_descripcion:z.item_descripcion});let r=d.value.findIndex(u=>u.item_id===z.item_id);r!==-1&&d.value.splice(r,1)}v.value=k.value.filter(r=>r.idSubZone===e.selected.idSubZone)}}),t.value=!1,a.emit("onUpdate",k.value)}}catch(h){console.log("mark:EDDA40AD3C64",h)}},K=(S,b)=>{try{d.value.push(b),d.value.sort(function(D,E){return D.item_descripcion>E.item_descripcion?1:D.item_descripcion<E.item_descripcion?-1:0});let h=v.value.findIndex(D=>D.item_id===b.item_id);h!==-1&&v.value.splice(h,1),a.emit("onUpdate",v.value)}catch(h){console.log("mark:04AD35E5A5CF",h)}},$=(S,b)=>{try{if(e.selected){const h={item_id:b.item_id,item_descripcion:b.item_descripcion},D={...e.selected,...h};v.value.push(D),k.value.push(D),v.value.sort(function(z,N){return z.item_descripcion>N.item_descripcion?1:z.item_descripcion<N.item_descripcion?-1:0});let E=d.value.findIndex(z=>z.item_id===h.item_id);E!==-1&&d.value.splice(E,1),a.emit("onUpdate",k.value)}}catch(h){console.log("mark:04AD35E5A5CF",h)}};return _e(async()=>{}),pe(()=>e.selected,(S,b)=>{v.value=k.value.filter(h=>h.idSubZone===e.selected.idSubZone)}),{columnsDb:It,rowsDb:d,tipo:L,options:j,rowsTemp:v,columnsTemp:xt,loading2:t,filterTemp:f,pagination:m({rowsPerPage:0}),visibleColumns:m(["insumo"]),loading:y,filter:s,rowCount:n,filterType:O,passData:$,restoreData:K,generarLista:T,generarTempLista:I,generarImportLista:q,loadingList:B}}},Et={class:"row q-pa-sm justify-between section"},zt={style:{width:"49%"}},Vt={style:{"margin-right":"1rem",width:"130px"}},Ft={style:{width:"49%"}},At={class:"row justify-start"};function Tt(e,a,y,t,s,f){return x(),G("div",Et,[Z("div",zt,[l(De,{class:"my-sticky-header-table",title:"Treats",dense:"",rows:t.rowsDb,columns:t.columnsDb,"row-key":"idrest",filter:t.filter,loading:t.loading,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[4]||(a[4]=n=>t.pagination=n),"no-data-label":"No se ha cargado inforamci\xF3n","rows-per-page-options":[0],"visible-columns":t.visibleColumns,onRowDblclick:t.passData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),header:c(n=>[l(ut,{props:n},{default:c(()=>[(x(!0),G(de,null,fe(n.cols,d=>(x(),U(st,{key:d.name,props:n,class:"text-italic text-white"},{default:c(()=>[H(se(d.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),top:c(()=>[Z("div",Vt,[l(rt,{dark:"",dense:"",standout:"",modelValue:t.tipo,"onUpdate:modelValue":[a[0]||(a[0]=n=>t.tipo=n),a[1]||(a[1]=n=>t.filterType())],options:t.options,"display-value":`${t.tipo?t.tipo.label:"Insumo"}`},null,8,["modelValue","options","display-value"])]),Z("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filter,"onUpdate:modelValue":a[3]||(a[3]=n=>t.filter=n)},{append:c(()=>[t.filterTemp===""?(x(),U(R,{key:0,name:"search"})):(x(),U(R,{key:1,name:"clear",class:"cursor-pointer",onClick:a[2]||(a[2]=n=>t.filterTemp="")}))]),_:1},8,["modelValue"])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])]),Z("div",Ft,[l(De,{class:"my-sticky-header-table",title:"Zone",dense:"",rows:t.rowsTemp,columns:t.columnsTemp,"row-key":"id",filter:t.filterTemp,loading:t.loading2,"virtual-scroll":"",pagination:t.pagination,"onUpdate:pagination":a[7]||(a[7]=n=>t.pagination=n),"rows-per-page-options":[0],"no-data-label":"I didn't find anything for you","visible-columns":t.visibleColumns,onRowDblclick:t.restoreData},{loading:c(()=>[l(xe,{showing:"",color:"primary"})]),top:c(()=>[Z("div",At,[Z("div",null,[l(ge,{dark:"",dense:"",standout:"",modelValue:t.filterTemp,"onUpdate:modelValue":a[6]||(a[6]=n=>t.filterTemp=n),class:"q-ml-sm"},{append:c(()=>[t.filterTemp===""?(x(),U(R,{key:0,name:"search"})):(x(),U(R,{key:1,name:"clear",class:"cursor-pointer",onClick:a[5]||(a[5]=n=>t.filterTemp="")}))]),_:1},8,["modelValue"])])])]),_:1},8,["rows","columns","filter","loading","pagination","visible-columns","onRowDblclick"])])])}var Lt=ue(qt,[["render",Tt]]);const Bt=Fe({name:"ImportDataModel",props:{onImport:{type:Function,required:!0}},setup(e){const a=m(null),y=s=>{const f=s.target.files;!f||!f.length||t(f[0])},t=s=>{const f=new FileReader;f.onload=n=>{var v;const d=(v=n.target)==null?void 0:v.result;a.value=JSON.parse(d),e.onImport(a.value)},f.readAsText(s)};return{prompt:m(!0),onFileChange:y}}}),Ot={class:"q-pa-md q-gutter-sm"},Qt=Z("div",{class:"text-h6"},"Selecciona la Plantilla",-1),Ut={id:"app"};function Rt(e,a,y,t,s,f){return x(),G("div",Ot,[l(Ve,{modelValue:e.prompt,"onUpdate:modelValue":a[1]||(a[1]=n=>e.prompt=n),persistent:""},{default:c(()=>[l(ie,{style:{"min-width":"400px"}},{default:c(()=>[l(ee,null,{default:c(()=>[Qt]),_:1}),l(ee,{class:"q-pt-none"},{default:c(()=>[Z("div",Ut,[Z("input",{type:"file",accept:"application/json",onChange:a[0]||(a[0]=(...n)=>e.onFileChange&&e.onFileChange(...n))},null,32)])]),_:1}),l(re,{align:"right",class:"text-primary"},{default:c(()=>[ve(l(A,{flat:"",label:"Cerrar"},null,512),[[it]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var jt=ue(Bt,[["render",Rt]]);const Nt=Fe({name:"NewInventoryTemplate",props:{show:{type:String,required:!1},templateId:{type:String,required:!1},templateName:{type:String,required:!1}},emits:[...oe.emits],components:{DualListBoxComponent:Lt,ImportDataModel:jt},setup(e){const a=Ae(),y=tt(),t=m(""),s=m(null),f=m([]),n=m(""),d=m([]),v=m(null),k=m(null),C=m(!0),L=m(!1),j=m(!1),O=m([]),B=m([]);let T="";const q=m(""),{supabase:I}=ct();m([]);const K=o=>{B.value=o,console.log(B.value)},$=m([{label:"Insumo",value:"(I)",dbVal:1},{label:"Producto",value:"(P)",dbVal:2},{label:"Descartable",value:"(D)",dbVal:6},{label:"Consumible",value:"(C)",dbVal:8},{label:"Receta",value:"(R)",dbVal:3},{label:"Derivado",value:"(De)",dbVal:7}]),S=()=>{try{a.dialog({title:"Confirmar",message:"Esta seguro que desea salir, es posible que no haya guardado",cancel:!0,persistent:!0}).onOk(()=>{y.go(-1)}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})}catch(o){console.log("mark:EF7259BC17FC",o)}},b=o=>{for(let i=0;i<d.value.length;i++)for(let p=0;p<o.length;p++)d.value[i].idZone===o[p].idZone&&(console.log(i),d.value.splice(i,1),i=0)},h=o=>{for(let i=0;i<d.value.length;i++)for(let p=0;p<o.length;p++)d.value[i].idSubZone===o[p].idSubZone&&(console.log(i),d.value.splice(i,1),i=0)},D=()=>{try{a.dialog({component:wt,componentProps:{simple:f.value}}).onOk(o=>{o.deletedZone.length>0&&b(o.deletedZone),o.deletedSubZone.length>0&&h(o.deletedSubZone),u(o.modelZones)}).onCancel(()=>{console.log("Cancel")})}catch(o){console.log("mark:162AD26EBCEE",o)}},E=(o,i)=>{let p=[];return o.forEach(g=>{g.plz_id===i&&p.push({label:g.description,idZone:g.plz_id,idSubZone:g.pls_id,icon:"fa-solid fa-location-dot",type:"child",selectable:!0})}),p},z=async o=>{var i;if(L.value=!1,o.length>0){f.value=o[0].simple;const p=o[0].list.map(w=>({idTemplate:void 0,idZone:w.idZone,idSubZone:w.idSubZone,item_id:w.item_id,item_descripcion:w.item_descripcion}));console.log("arr",p);const g=f.value[0];n.value=g.children[0].idSubZone,Y(n.value),await((i=s.value)==null?void 0:i.generarImportLista(p,g.children[0].idSubZone,"2"))}},N=()=>{const o=[{simple:f.value,list:d.value}],i=JSON.stringify(o),p=new Blob([i],{type:"text/plain"}),g=document.createEvent("MouseEvents"),w=document.createElement("a");w.download="test.json",w.href=window.URL.createObjectURL(p),w.dataset.downloadurl=["text/json",w.download,w.href].join(":"),g.initEvent("click",!0,!1),w.dispatchEvent(g)},Q=async o=>{try{let i=!1;const p={store:"6",dateInv:dt().format("YYYY-MM-DD%20HH:mm:00"),select:"*"};if(o!=="0"&&o!==""){if(O.value.length===0){for(let g=0;g<$.value.length;g++){const w=await he.getRestaurantItems(p,$.value[g].dbVal);if(w.success===1){i=!0;const te=w.originalResponse.body.data;te.length>0&&te&&te.forEach(ce=>{O.value.push(ce)})}}return j.value=!0,i}}else return i}catch(i){console.log("mark:EDDA40AD3C64",i)}};_e(async()=>{var o,i;try{if(s.value.loadingList(!0,e.show),await Q("1"),await((o=s.value)==null?void 0:o.generarLista(O.value)),e.show==="0")f.value=[],t.value="0";else if(e.show==="1"){q.value=e.templateName,t.value="1";let p=await I.from("bizTemplateZone").select().eq("PLI_Id",e.templateId),g=await I.from("biztemplatesubzone").select().eq("plz_pli_id",e.templateId),w=p.data.sort(function(P,ae){return P.Description>ae.Description?1:P.Description<ae.Description?-1:0}),te=g.data.sort(function(P,ae){return P.Description>ae.Description?1:P.Description<ae.Description?-1:0});f.value=[],w.forEach(P=>{f.value.push({label:P.Description,idSubZone:le(),idZone:P.PLZ_Id,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:E(te,P.PLZ_Id)})});const ce=f.value[0];n.value=ce.children[0].idSubZone,Y(n.value),await((i=s.value)==null?void 0:i.generarTempLista(e.templateId,"2"))}else y.push("/managerinventorytemplate");console.log(f.value),console.log("respose",j.value)}catch(p){console.log("mark:4B67FB683345",p)}});const Y=o=>{o&&f.value.forEach(i=>{const p=i.children.find(g=>g.idSubZone===o);p&&(v.value={idTemplate:e.templateId,idZone:p.idZone,idSubZone:p.idSubZone},k.value={Zone:i.label,SubZone:p.label})})},r=({node:o,key:i,done:p,fail:g})=>{if(o.length<1){p([]);return}p=f.value,console.log(p,"done")},u=async o=>{try{o&&(t.value="1",f.value=[],o.forEach(i=>{var p;f.value.push({label:i.name,idSubZone:le(),idZone:i.idZone,type:"father",icon:"fa-solid fa-map-location-dot",selectable:!1,children:(p=i.subZone)==null?void 0:p.map(g=>({label:g.nameSubZone,idZone:i.idZone,idSubZone:g.idSubZone,icon:"fa-solid fa-location-dot",type:"child",selectable:!0}))})}))}catch(i){console.log("mark:162AD26EBCEE",i)}},_=()=>!q.value||q.value===""?(T="Debe arregar una descripcion a la plantilla",!1):!0,V=()=>f.value.length===0?(T="Faltan datos en las zonas y subzonas",!1):!0,F=()=>d.value.length===0?(T="Debe arregar al menos un elemento a la plantilla",!1):!0,ne=async o=>{if((await I.from("bizTemplateZone").select("PLI_Id").eq("PLI_Id",o)).data.length>0){const{data:p,error:g}=await I.from("bizTemplateZone").delete().eq("PLI_Id",o);return g?(console.log(g),a.notify({position:"top",multiLine:!0,type:"negative",message:`No se han actualizado los datos ${g}`}),!1):!0}else return!0},Be=async()=>{try{const o=le(),i={Id:o,Description:q.value,Comment:"",ReadOnly:!1,System:!1},p=await he.createInventoryTemplate(i);return o}catch(o){console.log("mark:E2D87765FE56",o)}},Oe=async o=>{try{const i=f.value.map(g=>({PLI_Id:o,PLZ_Id:g.idZone,Description:g.label})),{error:p}=await I.from("bizTemplateZone").insert(i);p&&console.log(p)}catch(i){console.log("mark:E2D87765FE56",i)}},Qe=async o=>{try{let i=[];f.value.forEach(g=>{g.children.map(w=>{i.push({plz_pli_id:o,plz_id:w.idZone,pls_id:w.idSubZone,description:w.label})})});const{error:p}=await I.from("biztemplatesubzone").insert(i);p&&console.log(p)}catch(i){console.log("mark:E2D87765FE56",i)}},Ue=async o=>{try{let i=[];d.value.forEach(g=>{i.push({pls_plz_pli_id:o,pls_plz_id:g.idZone,pls_id:g.idSubZone,item:parseInt(g.item_id)})});const{error:p}=await I.from("biztemplateitem").insert(i);p&&console.log(p)}catch(i){console.log("mark:E2D87765FE56",i)}},Re=o=>{a.notify({position:"top",type:"negative",message:o})},je=async()=>{try{if(_()&&V()&&F()){const o=d.value[0].idTemplate?d.value[0].idTemplate:await Be();await ne(o)&&(await Oe(o),await Qe(o),await Ue(o),a.notify({position:"top",type:"positive",message:`Se ha creado la plantila ${q.value}`}),y.push("/managerinventorytemplate"))}else Re(T),T=""}catch(o){console.log("mark:ADB5994C7B4B",o)}},Ne=o=>{d.value=o,console.log("listitems",o)};return{splitterModel:m(25),modelDescription:q,listItems:d,expanded:C,showImport:L,treeData:v,selected:n,breadcumData:k,simple:f,visible:t,dualList:s,showZone:D,checkData:u,toBack:S,updateSelected:Y,onUpdateItems:Ne,saveAll:je,exportData:N,onImportData:z,onLazyLoad:r,updateExpanded:K,expandedNodes:B}}}),Pt={class:"q-pa-sm"},Mt=H(" Obligatorio "),$t={class:"q-pa-md"},Wt={class:"q-pa-sm container"};function Ht(e,a,y,t,s,f){const n=ke("DualListBoxComponent"),d=ke("ImportDataModel");return x(),G(de,null,[Z("div",Pt,[Z("div",null,[l(at,{class:"bg-primary q-mb-md text-white",style:{"padding-top":"0.5rem"}},{default:c(()=>[l(A,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Guardar",onClick:a[0]||(a[0]=v=>e.saveAll()),icon:"fa-regular fa-floppy-disk",style:{"line-height":"1.5rem"}}),l(A,{flat:"",stack:"",size:"12px","no-caps":"",label:"Eliminar",icon:"fa-regular fa-trash-can",style:{"line-height":"1.5rem"}}),l(J,{vertical:"",color:"warning",inset:""}),l(A,{stack:"",flat:"",size:"12px","no-caps":"",onClick:a[1]||(a[1]=v=>e.showZone()),onOk:e.checkData,label:"Editar Zonas",icon:"fa-solid fa-map-location-dot",style:{"line-height":"1.5rem"}},null,8,["onOk"]),l(J,{vertical:"",inset:"",color:"warning"}),l(A,{stack:"",flat:"",size:"12px","no-caps":"",class:"q-mx-sm",label:"Importar",onClick:a[2]||(a[2]=v=>e.showImport=!0),icon:"fa-solid fa-file-import",style:{"line-height":"1.5rem"}}),l(A,{stack:"",flat:"",size:"12px","no-caps":"",label:"Exportar",onClick:a[3]||(a[3]=v=>e.exportData()),icon:"fa-solid fa-file-export",style:{"line-height":"1.5rem"},disable:!e.templateId},null,8,["disable"]),l(J,{vertical:"",inset:"",color:"warning"}),l(A,{stack:"",flat:"",size:"12px","no-caps":"",label:"Atras",onClick:e.toBack,icon:"fa-regular fa-hand-point-left",style:{"line-height":"1.5rem"}},null,8,["onClick"])]),_:1})]),Z("div",null,[Z("div",null,[l(mt,{modelValue:e.splitterModel,"onUpdate:modelValue":a[9]||(a[9]=v=>e.splitterModel=v)},{before:c(()=>[Z("div",null,[l(ge,{"bottom-slots":"",modelValue:e.modelDescription,"onUpdate:modelValue":a[5]||(a[5]=v=>e.modelDescription=v),label:"Descripcion",rounded:""},{prepend:c(()=>[l(R,{name:"place"})]),append:c(()=>[l(R,{name:"close",onClick:a[4]||(a[4]=v=>e.modelDescription=""),class:"cursor-pointer"})]),hint:c(()=>[Mt]),_:1},8,["modelValue"])]),Z("div",$t,[l(lt,{nodes:e.simple,accordion:!1,expanded:e.expandedNodes,"onUpdate:expanded":[a[6]||(a[6]=v=>e.expandedNodes=v),e.updateExpanded],expandedModifiers:{sync:!0},"node-key":"idSubZone","label-key":"label","selected-color":"primary",selected:e.selected,"onUpdate:selected":[a[7]||(a[7]=v=>e.selected=v),e.updateSelected]},null,8,["nodes","expanded","selected","onUpdate:selected","onUpdate:expanded"])])]),after:c(()=>[e.breadcumData?(x(),U(ot,{key:0,class:"q-px-md text-orange"},{default:c(()=>[l(Se,{label:e.breadcumData.Zone,icon:"fa-solid fa-map-location-dot"},null,8,["label"]),l(Se,{label:e.breadcumData.SubZone,icon:"fa-solid fa-location-dot"},null,8,["label"])]),_:1})):be("",!0),Z("div",Wt,[l(n,{ref:"dualList",modelValue:e.listItems,"onUpdate:modelValue":a[8]||(a[8]=v=>e.listItems=v),selected:e.treeData,show:e.visible,onOnUpdate:e.onUpdateItems},null,8,["modelValue","selected","show","onOnUpdate"])])]),_:1},8,["modelValue"])])])]),e.showImport?(x(),U(d,{key:0,onImport:e.onImportData},null,8,["onImport"])):be("",!0)],64)}var ra=ue(Nt,[["render",Ht]]);export{ra as default};
